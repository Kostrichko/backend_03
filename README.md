# Task Manager ‚Äî Django + Aiogram

–°–∏—Å—Ç–µ–º–∞ —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è –∑–∞–¥–∞—á–∞–º–∏: Django REST API –±—ç–∫–µ–Ω–¥ + Telegram-–±–æ—Ç –Ω–∞ aiogram —Å —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è–º–∏ —á–µ—Ä–µ–∑ Celery.


## –ë—ã—Å—Ç—Ä—ã–π —Å—Ç–∞—Ä—Ç

```bash
git clone <repository-url>
cd django_aiogram
```

–°–æ–∑–¥–∞–π—Ç–µ `.env` –≤ –∫–æ—Ä–Ω–µ –ø—Ä–æ–µ–∫—Ç–∞:

```env
BOT_TOKEN=—Ç–æ–∫–µ–Ω_–æ—Ç_@BotFather
API_KEY=–ø—Ä–æ–∏–∑–≤–æ–ª—å–Ω—ã–π_—Å–µ–∫—Ä–µ—Ç–Ω—ã–π_–∫–ª—é—á
POSTGRES_DB=django_aiogram
POSTGRES_USER=postgres
POSTGRES_PASSWORD=postgres
POSTGRES_HOST=postgres
POSTGRES_PORT=5432
```

–ó–∞–ø—É—Å–∫:

```bash
docker compose up -d --build
docker compose exec web python manage.py migrate
```

–û—Ç–∫—Ä–æ–π—Ç–µ –±–æ—Ç–∞ –≤ Telegram –∏ –æ—Ç–ø—Ä–∞–≤—å—Ç–µ `/start`.

## –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

```
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     HTTP/JSON      ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  Telegram    ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚ñ∫‚îÇ   aiogram    ‚îÇ
‚îÇ  Bot API     ‚îÇ                    ‚îÇ   (bot/)     ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò                    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                                           ‚îÇ aiohttp
                                           ‚ñº
‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê
‚îÇ  PostgreSQL  ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ    Django    ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÇ    Redis     ‚îÇ
‚îÇ              ‚îÇ     ‚îÇ  (backend/)  ‚îÇ     ‚îÇ              ‚îÇ
‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚î¨‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                            ‚îÇ                     ‚îÇ
                            ‚ñº                     ‚îÇ
                     ‚îå‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îê             ‚îÇ
                     ‚îÇ   Celery     ‚îÇ‚óÑ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
                     ‚îÇ   Worker     ‚îÇ
                     ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```


### –í–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏–µ

- –ë–æ—Ç –æ–±—â–∞–µ—Ç—Å—è —Å –±—ç–∫–µ–Ω–¥–æ–º –ø–æ –≤–Ω—É—Ç—Ä–µ–Ω–Ω–µ–π —Å–µ—Ç–∏ Docker —á–µ—Ä–µ–∑ REST API
- –ê—É—Ç–µ–Ω—Ç–∏—Ñ–∏–∫–∞—Ü–∏—è —á–µ—Ä–µ–∑ –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-API-Key`
- –ë—ç–∫–µ–Ω–¥ —Ä–∞–±–æ—Ç–∞–µ—Ç —Å –ë–î
- –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –ø–ª–∞–Ω–∏—Ä—É—é—Ç—Å—è —á–µ—Ä–µ–∑ Celery ETA

## –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
‚îú‚îÄ‚îÄ backend/
‚îÇ   ‚îú‚îÄ‚îÄ config/                  # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ Django, Celery
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ settings_test.py     # –¢–µ—Å—Ç–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ celery.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ urls.py
‚îÇ   ‚îú‚îÄ‚îÄ api/
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ models.py            # User, Task, Tag
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ views.py             # API-—ç–Ω–¥–ø–æ–∏–Ω—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ serializers.py       # DRF-—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ middleware.py        # APIKeyMiddleware
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks.py             # Celery-–∑–∞–¥–∞—á–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ services/            # –°–µ—Ä–≤–∏—Å–Ω—ã–π —É—Ä–æ–≤–µ–Ω—å
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ user_service.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ task_service.py
‚îÇ   ‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tag_service.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tests/               # –Æ–Ω–∏—Ç –∏ –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ test_models.py
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ test_serializers.py
‚îÇ   ‚îÇ       ‚îú‚îÄ‚îÄ test_services.py
‚îÇ   ‚îÇ       ‚îî‚îÄ‚îÄ test_views.py
‚îÇ   ‚îú‚îÄ‚îÄ pyproject.toml 
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îú‚îÄ‚îÄ requirements-dev.txt
‚îÇ   ‚îî‚îÄ‚îÄ run_checks.sh            # –°–∫—Ä–∏–ø—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ª–∏–Ω—Ç–∏–Ω–≥–∞
‚îú‚îÄ‚îÄ bot/
‚îÇ   ‚îú‚îÄ‚îÄ main.py 
‚îÇ   ‚îú‚îÄ‚îÄ config.py                # –ù–∞—Å—Ç—Ä–æ–π–∫–∏ –±–æ—Ç–∞
‚îÇ   ‚îú‚îÄ‚îÄ handlers/ 
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ __init__.py  
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ common.py            # /start, –∫–ª–∞–≤–∏–∞—Ç—É—Ä–∞
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ tasks.py             # FSM –∑–∞–¥–∞—á
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ tags.py              # FSM –¥–ª—è —Ç–µ–≥–æ–≤
‚îÇ   ‚îú‚îÄ‚îÄ services/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ api_client.py  
‚îÇ   ‚îú‚îÄ‚îÄ tests/                   # –Æ–Ω–∏—Ç —Ç–µ—Å—Ç—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ conftest.py
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ test_api_client.py
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ test_handlers.py
‚îÇ   ‚îú‚îÄ‚îÄ requirements.txt
‚îÇ   ‚îú‚îÄ‚îÄ requirements-dev.txt
‚îÇ   ‚îú‚îÄ‚îÄ pytest.ini
‚îÇ   ‚îî‚îÄ‚îÄ run_checks.sh            # –°–∫—Ä–∏–ø—Ç –¥–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–≥–æ –ª–∏–Ω—Ç–∏–Ω–≥–∞
‚îú‚îÄ‚îÄ docker-compose.yml
‚îú‚îÄ‚îÄ Dockerfile
‚îú‚îÄ‚îÄ .env.example
‚îú‚îÄ‚îÄ .gitignore
‚îî‚îÄ‚îÄ .env
```

## API

–í—Å–µ —ç–Ω–¥–ø–æ–∏–Ω—Ç—ã —Ç—Ä–µ–±—É—é—Ç –∑–∞–≥–æ–ª–æ–≤–æ–∫ `X-API-Key`. –ü—Ä–µ—Ñ–∏–∫—Å: `/api/`.



**–°—Ç–∞—Ç—É—Å—ã –∑–∞–¥–∞—á–∏:** `pending` ‚Üí `completed` | `deleted`

## –õ–∏–º–∏—Ç—ã

| –ü–∞—Ä–∞–º–µ—Ç—Ä | –ó–Ω–∞—á–µ–Ω–∏–µ | –ù–∞—Å—Ç—Ä–æ–π–∫–∞ |
|----------|----------|-----------|
| –ê–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á | 6 | `MAX_PENDING_TASKS_PER_USER` |
| –¢–µ–≥–æ–≤ | 4 | `MAX_TAGS_PER_USER` |
| –ê—Ä—Ö–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á (–≤ —Å–ø–∏—Å–∫–µ) | 5 | `MAX_ARCHIVE_TASKS_PER_USER` |

–ù–∞—Å—Ç—Ä–∞–∏–≤–∞—é—Ç—Å—è –≤ `backend/config/settings.py` –∏ –¥—É–±–ª–∏—Ä—É—é—Ç—Å—è –≤ `bot/config.py`.

## Telegram-–±–æ—Ç

### –ö–æ–º–∞–Ω–¥—ã –∏ –∫–Ω–æ–ø–∫–∏

| –ö–æ–º–∞–Ω–¥–∞ / –ö–Ω–æ–ø–∫–∞ | –î–µ–π—Å—Ç–≤–∏–µ |
|------------------|----------|
| `/start` | –†–µ–≥–∏—Å—Ç—Ä–∞—Ü–∏—è, –≥–ª–∞–≤–Ω–æ–µ –º–µ–Ω—é |
| ‚ûï –ù–æ–≤–∞—è –∑–∞–¥–∞—á–∞ | –°–æ–∑–¥–∞–Ω–∏–µ –∑–∞–¥–∞—á–∏ (FSM: –Ω–∞–∑–≤–∞–Ω–∏–µ ‚Üí –≤—Ä–µ–º—è ‚Üí —Ç–µ–≥–∏) |
| üìã –ú–æ–∏ –∑–∞–¥–∞—á–∏ | –°–ø–∏—Å–æ–∫ –∞–∫—Ç–∏–≤–Ω—ã—Ö –∑–∞–¥–∞—á |
| üè∑ –¢–µ–≥–∏ | –°–ø–∏—Å–æ–∫ —Ç–µ–≥–æ–≤ —Å —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ–º |
| üì¶ –ê—Ä—Ö–∏–≤ | –ó–∞–≤–µ—Ä—à—ë–Ω–Ω—ã–µ –∏ —É–¥–∞–ª—ë–Ω–Ω—ã–µ –∑–∞–¥–∞—á–∏ |
| üóë –£–¥–∞–ª–∏—Ç—å –∑–∞–¥–∞—á—É | –í—ã–±–æ—Ä –∑–∞–¥–∞—á–∏ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è |
| ‚ûï –ù–æ–≤—ã–π —Ç–µ–≥ | –°–æ–∑–¥–∞–Ω–∏–µ —Ç–µ–≥–∞ |

### FSM-—Å–æ—Å—Ç–æ—è–Ω–∏—è

**CreateTaskState:** `title` -> `notify_time` -> `tags`
- –í—Ä–µ–º—è —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è: 1 –º–∏–Ω, 2 –º–∏–Ω, 5 –º–∏–Ω, 10 –º–∏–Ω, 1 —á–∞—Å
- –¢–µ–≥–∏: –≤—ã–±–æ—Ä –∏–∑ —Å—É—â–µ—Å—Ç–≤—É—é—â–∏—Ö —á–µ—Ä–µ–∑ inline-–∫–Ω–æ–ø–∫–∏, –º–æ–∂–Ω–æ –ø—Ä–æ–ø—É—Å—Ç–∏—Ç—å

**CreateTagState:** `name`

## –£–≤–µ–¥–æ–º–ª–µ–Ω–∏—è

–ü—Ä–∏ —Å–æ–∑–¥–∞–Ω–∏–∏ –∑–∞–¥–∞—á–∏ —Å `due_date` –±—ç–∫–µ–Ω–¥ —Å—Ç–∞–≤–∏—Ç Celery-–∑–∞–¥–∞—á—É —Å `eta=due_date`. –í –Ω–∞–∑–Ω–∞—á–µ–Ω–Ω–æ–µ –≤—Ä–µ–º—è –≤–æ—Ä–∫–µ—Ä –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å–æ–æ–±—â–µ–Ω–∏–µ —á–µ—Ä–µ–∑ Telegram Bot API. –ù–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è polling ‚Äî –∑–∞–¥–∞—á–∞ –≤—ã–ø–æ–ª–Ω—è–µ—Ç—Å—è —Ä–æ–≤–Ω–æ –æ–¥–∏–Ω —Ä–∞–∑ –≤ –Ω—É–∂–Ω—ã–π –º–æ–º–µ–Ω—Ç.

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ

### Backend ‚Äî 54 —Ç–µ—Å—Ç–∞

```bash
# –õ–æ–∫–∞–ª—å–Ω–æ (Python 3.11+)
cd backend
pip install -r requirements.txt -r requirements-dev.txt
python manage.py test --settings=config.settings_test

# –ß–µ—Ä–µ–∑ Docker
docker compose exec web python manage.py test --settings=config.settings_test
```

–¢–µ—Å—Ç–æ–≤—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏: SQLite in-memory, DummyCache, rate limiting –æ—Ç–∫–ª—é—á—ë–Ω.

- **test_models.py** ‚Äî —Å–æ–∑–¥–∞–Ω–∏–µ –º–æ–¥–µ–ª–µ–π, —Å–≤—è–∑–∏, ordering
- **test_serializers.py** ‚Äî –≤–∞–ª–∏–¥–∞—Ü–∏—è –≤—Å–µ—Ö —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ç–æ—Ä–æ–≤
- **test_services.py** ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ (–ª–∏–º–∏—Ç—ã, –¥—É–±–ª–∏–∫–∞—Ç—ã, CRUD)
- **test_views.py** ‚Äî –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Å—Ç—ã —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ + APIKeyMiddleware

### Bot ‚Äî 5 —Ç–µ—Å—Ç–æ–≤

```bash
cd bot
pip install -r requirements.txt -r requirements-dev.txt
pytest -W ignore::DeprecationWarning tests/
```

- **test_api_client.py** ‚Äî —É—Å–ø–µ—à–Ω—ã–π –∑–∞–ø—Ä–æ—Å, –æ–±—Ä–∞–±–æ—Ç–∫–∞ HTTP-–æ—à–∏–±–æ–∫
- **test_handlers.py** ‚Äî `/start`, —Å–ø–∏—Å–æ–∫ –∑–∞–¥–∞—á (–ø—É—Å—Ç–æ–π –∏ —Å –¥–∞–Ω–Ω—ã–º–∏)

### –õ–∏–Ω—Ç–∏–Ω–≥

```bash
cd backend && ./run_checks.sh    # tests + black + flake8 + mypy
cd bot && ./run_checks.sh        # tests + black + flake8
```

## CI/CD

GitHub Actions (`.github/workflows/ci.yml`) ‚Äî 3 –ø–∞—Ä–∞–ª–ª–µ–ª—å–Ω—ã—Ö job'–∞:

| Job | –ß—Ç–æ –ø—Ä–æ–≤–µ—Ä—è–µ—Ç |
|-----|---------------|
| `backend-test` | Django-—Ç–µ—Å—Ç—ã (SQLite) |
| `bot-test` | pytest –±–æ—Ç–∞ |
| `lint` | Black, flake8, mypy (backend) |

–¢—Ä–∏–≥–≥–µ—Ä—ã: push –∏ PR –≤ –≤–µ—Ç–∫–∏ `main` –∏ `dev`.

## –ö–ª—é—á–µ–≤—ã–µ —Ä–µ—à–µ–Ω–∏—è

| –†–µ—à–µ–Ω–∏–µ | –û–±–æ—Å–Ω–æ–≤–∞–Ω–∏–µ |
|---------|-------------|
| `telegram_id` –∫–∞–∫ PK | –£–Ω–∏–∫–∞–ª–µ–Ω, –Ω–µ –º–µ–Ω—è–µ—Ç—Å—è, –ø—Ä—è–º–æ–π –º–∞–ø–ø–∏–Ω–≥ –±–æ—Ç<->API |
| Service Layer | –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –æ—Ç–¥–µ–ª–µ–Ω–∞ –æ—Ç views, –ª–µ–≥–∫–æ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å |
| Celery ETA –≤–º–µ—Å—Ç–æ beat | –¢–æ—á–Ω—ã–µ —É–≤–µ–¥–æ–º–ª–µ–Ω–∏—è –±–µ–∑ –ø–µ—Ä–∏–æ–¥–∏—á–µ—Å–∫–æ–≥–æ polling –ë–î |
| ReplyKeyboard | –ü–æ—Å—Ç–æ—è–Ω–Ω–æ –≤–∏–¥–∏–º–æ–µ –º–µ–Ω—é, –º–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫ –≤–≤–æ–¥–∞ |
| FSM –¥–ª—è –¥–∏–∞–ª–æ–≥–æ–≤ | –ß—ë—Ç–∫–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞, –≤–∞–ª–∏–¥–∞—Ü–∏—è –Ω–∞ –∫–∞–∂–¥–æ–º —à–∞–≥–µ |
| APIKeyMiddleware | –ó–∞—â–∏—Ç–∞ –≤—Å–µ—Ö —ç–Ω–¥–ø–æ–∏–Ω—Ç–æ–≤ –æ–¥–Ω–∏–º —Å–ª–æ–µ–º |
| Rate limiting | django-ratelimit –Ω–∞ –∫–∞–∂–¥–æ–º —ç–Ω–¥–ø–æ–∏–Ω—Ç–µ |
